(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("router");var r=e.n(t);const n=require("events");var o=e.n(n);const a=require("LogUtil");var s=e.n(a);const c=require("storage");var i=e.n(c);const u=require("Requester");var d=e.n(u),p={contentType:"application/x-www-form-urlencoded",data:{grant_type:"password",username:"Pareto_Sandbox",password:"Infront542!",client_id:"wtk-client",client_secret:"1e526587-0882-411d-9d59-ae2b7a75d608",scope:"openid"}},v=i().getKeyValueDataStore("paretosec-dev"),f=function(){return d().post("https://pareto.cloud.eu.infrontservices.com/auth/realms/pareto/protocol/openid-connect/token",p).done((function(e){v.put("token",e);var t=new Date,r=t.setSeconds(t.getSeconds()+(e.expires_in-4e3));v.put("expiry_date_time",{dateTime:r})})).fail((function(e){s().error(JSON.stringify(e))}))};o().on("sv:every-hour",(function(e){try{var t=v.get("expiry_date_time");new Date>new Date(t.dateTime)&&f()}catch(e){s().error(JSON.stringify(e))}})),r().get("/token",(function(e,t){var r=v.get("token");t.json({token:r.access_token})})),r().get("/token/refresh",(function(e,t){f();var r=v.get("token");t.json({token:r.access_token})}))})();